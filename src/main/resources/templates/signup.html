<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Inscription - Air Algérie</title>
  <link rel="stylesheet" href="/css/signup.css">
</head>
<body>
  <header>…logo/header here…</header>

  <main class="signup-container">
    <div class="signup-box">
      <h2 class="signup-title">Créer un compte employé</h2>
      <form id="signupForm">
        <!-- all your inputs with id="name", "lastname", etc. -->
        <button type="submit" class="btn-signup">S'inscrire</button>
        <div id="errorMessage" class="error-message"></div>
      </form>
    </div>
  </main>

  
  <!-- <script>
    const user = JSON.parse(sessionStorage.getItem('user') || '{}');
    if (user.role !== 'ROLE_ADMIN') {
      window.location.href = '/login.html';
    }
  </script> -->
  
  <script>
    document.getElementById('signupForm').addEventListener('submit', async e => {
    e.preventDefault();
    const data = {
        name: document.getElementById('name').value,
        lastname: document.getElementById('lastname').value,
        dateEntree: document.getElementById('dateEntree').value,
        email: document.getElementById('email').value,
        motdepasse: document.getElementById('motdepasse').value,
        roleId: parseInt(document.getElementById('roleId').value, 10),
        idAffectation: parseInt(document.getElementById('idAffectation').value, 10),
        idFonction: parseInt(document.getElementById('idFonction').value, 10)
    };

    // optional: confirm passwords match
    if (data.motdepasse !== document.getElementById('confirmPassword').value) {
        return document.getElementById('errorMessage').innerText = 
        'Passwords do not match';
    }

    try {
        const resp = await fetch('/api/employes/create', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            // include JWT cookie automatically; no Authorization header needed
        },
        body: JSON.stringify(data)
        });

        if (!resp.ok) {
        const text = await resp.text();
        throw new Error(text);
        }
        alert('Employee created successfully!');
        // optionally, clear form or redirect back to dashboard
        window.location.href = '/acceuil.html';
    } catch (err) {
        document.getElementById('errorMessage').innerText = err.message;
    }
    });
  </script>
</body>
</html>
